import{_ as v}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as m,i as g,c as a,j as i,t as n,a as e,e as l,o as s}from"./index-2iTPgyOA.js";const f={class:"max-w-2xl mx-auto py-20 px-6 text-center"},x={key:0,class:"text-3xl font-bold mb-4"},y={key:1,class:"text-3xl font-bold mb-4"},b={key:2},_={key:3},k={key:4},T={key:5,class:"mt-10 text-left text-sm bg-gray-50 rounded p-6 shadow"},E={key:6,class:"text-gray-500 mt-10"},w={key:7,class:"text-green-600 mt-10"},O={key:8,class:"text-yellow-600 mt-10"},P={key:9,class:"text-red-600 mt-10"},j={__name:"ConfirmacionPago",setup(h){const r=m("cargando"),t=m(null);return g(async()=>{const o=new URLSearchParams(window.location.search).get("token_ws");if(!o){r.value="error",t.value={mensaje:"Token de pago no encontrado en la URL."};return}try{const d=await fetch("http://localhost:3000/api/webpay/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token_ws:o})}),u=await d.json();d.ok&&u.status==="AUTHORIZED"?(r.value="exito",t.value=u):(r.value="rechazado",t.value=u)}catch(d){console.error("[❌ Error en confirmación Webpay]",d),r.value="error",t.value={mensaje:"Error técnico al confirmar el pago."}}}),(c,o)=>{var d,u,p;return s(),a("div",f,[((d=t.value)==null?void 0:d.status)==="AUTHORIZED"?(s(),a("h1",x,"✅ ¡Pago confirmado!")):t.value?(s(),a("h1",y,"❌ Estado: "+n(t.value.status),1)):i("",!0),((u=t.value)==null?void 0:u.status)==="AUTHORIZED"?(s(),a("p",b," Gracias por tu compra. Te enviaremos el informe SEO en menos de 24 horas hábiles. ")):t.value?(s(),a("p",_,"Tu pago no pudo ser confirmado. Estado recibido: "+n(t.value.status),1)):(s(),a("p",k,"Validando tu pago...")),((p=t.value)==null?void 0:p.status)==="AUTHORIZED"?(s(),a("div",T,[o[5]||(o[5]=e("h2",{class:"text-lg font-semibold mb-2"},"Detalles de la transacción",-1)),e("p",null,[o[0]||(o[0]=e("strong",null,"Orden de compra:",-1)),l(" "+n(t.value.buy_order),1)]),e("p",null,[o[1]||(o[1]=e("strong",null,"Monto pagado:",-1)),l(" $"+n(t.value.amount),1)]),e("p",null,[o[2]||(o[2]=e("strong",null,"Tarjeta:",-1)),l(" **** **** **** "+n(t.value.card_detail.card_number),1)]),e("p",null,[o[3]||(o[3]=e("strong",null,"Tipo de pago:",-1)),l(" "+n(t.value.payment_type_code),1)]),e("p",null,[o[4]||(o[4]=e("strong",null,"Código de autorización:",-1)),l(" "+n(t.value.authorization_code),1)])])):i("",!0),r.value==="cargando"?(s(),a("div",E," Procesando tu pago... ⏳ ")):r.value==="exito"?(s(),a("div",w,[o[8]||(o[8]=e("p",{class:"text-xl font-semibold mb-2"},"✅ ¡Pago aprobado!",-1)),e("p",null,[o[6]||(o[6]=l("Tu orden ")),e("strong",null,n(t.value.buy_order),1),o[7]||(o[7]=l(" fue confirmada con éxito."))])])):r.value==="rechazado"?(s(),a("div",O,[o[10]||(o[10]=e("p",{class:"text-xl font-semibold mb-2"},"⚠️ Pago rechazado o no autorizado.",-1)),e("p",null,[o[9]||(o[9]=l("Estado entregado por Transbank: ")),e("strong",null,n(t.value.status),1)])])):r.value==="error"?(s(),a("div",P,[o[11]||(o[11]=e("p",{class:"text-xl font-semibold mb-2"},"❌ Error al procesar el pago",-1)),e("p",null,n(t.value.mensaje),1)])):i("",!0)])}}},R=v(j,[["__scopeId","data-v-f4284caf"]]);export{R as default};
